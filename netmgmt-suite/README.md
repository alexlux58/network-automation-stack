# Network Management Suite

A comprehensive network management and automation platform that integrates **NetBox**, **Nautobot**, **Jenkins**, **Oxidized**, and **Filebeat** with your existing observability stack. This suite provides network documentation, automation, configuration management, and centralized logging.

## 🏗️ Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   NetBox        │    │   Nautobot      │    │   Jenkins       │
│   (Port 8080)   │    │   (Port 8081)   │    │   (Port 8090)   │
│   - IPAM        │    │   - Automation  │    │   - CI/CD       │
│   - DCIM        │    │   - Plugins     │    │   - Pipelines   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   Filebeat      │
                    │   (Log Shipper) │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │ Observability   │
                    │ Stack           │
                    │ 192.168.5.13    │
                    │ - ELK Stack     │
                    │ - Prometheus    │
                    │ - Grafana       │
                    └─────────────────┘
```

## 🚀 Quick Start

### Prerequisites
- Docker and Docker Compose installed
- At least 4GB RAM and 2 CPU cores available
- Network access to your observability stack (192.168.5.13)
- Server accessible at 192.168.5.9 for LAN access

### Option 1: Using the Wrapper Script (Recommended)
```bash
# Run the bootstrap script to generate all files
bash bootstrap_netmgmt_suite.sh
cd netmgmt-suite

# Use the wrapper script for easy management
./scripts/netmgmt.sh bootstrap    # First time setup
./scripts/netmgmt.sh start        # Start all services
./scripts/netmgmt.sh status       # Check service status
./scripts/netmgmt.sh logs         # View live logs
./scripts/netmgmt.sh stop         # Stop all services
```

### Option 2: Manual Setup
```bash
# Run the bootstrap script to generate all files
bash bootstrap_netmgmt_suite.sh
cd netmgmt-suite

# Generate secure secret keys
make gen-secrets

# Review and customize the .env file
nano .env

# Build and start all services
make up

# Wait for services to be healthy, then create superusers
make bootstrap

# View all service URLs
make urls
```

## 📋 Service Overview

| Service | Port | Local URL | LAN URL | Purpose | Default Credentials |
|---------|------|-----------|---------|---------|-------------------|
| **NetBox** | 8080 | http://localhost:8080/ | http://192.168.5.9:8080/ | IPAM/DCIM | admin / GenerateStrongPassword123! |
| **Nautobot** | 8081 | http://localhost:8081/ | http://192.168.5.9:8081/ | Network Automation | admin / GenerateStrongPassword123! |
| **Jenkins** | 8090 | http://localhost:8090/ | http://192.168.5.9:8090/ | CI/CD Pipeline | (Initial setup required) |
| **Oxidized** | 8888 | http://localhost:8888/ | http://192.168.5.9:8888/ | Config Backup | (Web interface) |
| **pgAdmin** | 5050 | http://localhost:5050/ | http://192.168.5.9:5050/ | Database Admin | admin@example.com / GenerateStrongPassword123! |
| **Redis Commander** | 8082 | http://localhost:8082/ | http://192.168.5.9:8082/ | Redis Management | (No auth) |

## 🔧 Configuration

### Environment Variables (.env)
```bash
# Timezone and Network Access
TZ=America/Los_Angeles
ALLOWED_HOSTS=127.0.0.1,localhost,192.168.5.9,192.168.5.13

# NetBox Configuration
NETBOX_DB_PASSWORD=changeme_netbox_db
NETBOX_SECRET_KEY=changeme_netbox_secret  # Auto-generated by make gen-secrets
NETBOX_SUPERUSER_NAME=admin
NETBOX_SUPERUSER_EMAIL=admin@example.com
NETBOX_SUPERUSER_PASSWORD=GenerateStrongPassword123!

# Nautobot Configuration
NAUTOBOT_DB_PASSWORD=changeme_nautobot_db
NAUTOBOT_SECRET_KEY=changeme_nautobot_secret  # Auto-generated by make gen-secrets
NAUTOBOT_SUPERUSER_NAME=admin
NAUTOBOT_SUPERUSER_EMAIL=admin@example.com
NAUTOBOT_SUPERUSER_PASSWORD=GenerateStrongPassword123!

# Observability Stack Integration
LOGSTASH_HOST=192.168.5.13
LOGSTASH_PORT=5044
```

### Customizing for Your Environment
1. **Update ALLOWED_HOSTS**: Add your server's IP addresses (currently configured for 192.168.5.9)
2. **Change Passwords**: Update all password fields in .env
3. **Adjust Resource Limits**: Modify CPU/memory limits in docker-compose.yml if needed
4. **Update Observability Stack**: Change LOGSTASH_HOST if your stack is elsewhere
5. **LAN Access**: Services are configured to be accessible from your LAN at 192.168.5.9

## 🌐 LAN Deployment

This suite is configured for deployment at **192.168.5.9** and is accessible from your local area network:

### Network Configuration
- **Deployment Server**: 192.168.5.9
- **Observability Stack**: 192.168.5.13
- **Port Binding**: All services bind to 0.0.0.0 (accessible from LAN)
- **Firewall**: Ensure ports 8080, 8081, 8090, 8888, 5050, 8082 are open

### Access Methods
1. **Local Access**: http://localhost:PORT/ (from the server itself)
2. **LAN Access**: http://192.168.5.9:PORT/ (from any device on your LAN)
3. **Remote Access**: Configure port forwarding or VPN for external access

### Security Considerations
- Services are accessible from your LAN by default
- Use strong passwords (configured in .env)
- Consider setting up a reverse proxy with SSL for production use
- Restrict access via firewall rules if needed

## 🔍 Monitoring & Observability

### Integration with Your Observability Stack
This suite is pre-configured to integrate with your observability stack at **192.168.5.13**:

- **Elasticsearch**: http://192.168.5.13:9200/ (Log storage)
- **Kibana**: http://192.168.5.13:5601/ (Log visualization)
- **Grafana**: http://192.168.5.13:3000/ (Metrics dashboards)
- **Prometheus**: http://192.168.5.13:9090/ (Metrics collection)
- **Alertmanager**: http://192.168.5.13:9093/ (Alerting)

### Prometheus Monitoring
- **Configuration**: `./monitoring/prometheus-netmgmt.yml`
- **Metrics Endpoints**: All services expose Prometheus metrics
- **Service Discovery**: Automatic discovery via Docker labels

### Logging
- **Filebeat**: Ships container logs to your ELK stack
- **Log Index**: `netmgmt-YYYY.MM.DD` in Elasticsearch
- **Service Tagging**: Logs include service and project metadata

## 🛠️ Operations

### Wrapper Script (Recommended)
The `scripts/netmgmt.sh` script provides an easy-to-use interface for managing the entire suite:

```bash
./scripts/netmgmt.sh bootstrap    # Bootstrap project (first time setup)
./scripts/netmgmt.sh start        # Start all services
./scripts/netmgmt.sh stop         # Stop all services
./scripts/netmgmt.sh restart      # Restart all services
./scripts/netmgmt.sh status       # Show service status and URLs
./scripts/netmgmt.sh logs         # Show live logs from all services
./scripts/netmgmt.sh backup       # Create backup of databases and volumes
./scripts/netmgmt.sh destroy      # Destroy project and all data (DESTRUCTIVE!)
./scripts/netmgmt.sh help         # Show help message
```

**Features of the wrapper script:**
- ✅ **Prerequisites checking**: Validates Docker, resources, and port availability
- ✅ **Observability stack validation**: Checks connectivity to your monitoring stack
- ✅ **Interactive prompts**: Asks for confirmation on destructive operations
- ✅ **Colored output**: Easy-to-read status messages
- ✅ **Health monitoring**: Waits for services to be healthy before proceeding
- ✅ **Backup functionality**: Automated database and volume backups
- ✅ **Error handling**: Comprehensive error checking and user feedback

### Make Commands (Alternative)
```bash
make help          # Show all available commands
make build         # Build custom Docker images
make up            # Start all services
make down          # Stop services
make destroy       # Stop and remove volumes (DESTRUCTIVE!)
make logs          # Tail logs from all services
make ps            # Show service status
make gen-secrets   # Generate secure secret keys
make bootstrap     # Create superusers (idempotent)
make urls          # Display all service URLs
```

### Service Management
```bash
# View logs for specific service
docker compose logs -f netbox

# Restart a service
docker compose restart netbox

# Scale a service
docker compose up -d --scale netbox-worker=2

# Execute commands in containers
docker compose exec netbox python manage.py shell
docker compose exec nautobot nautobot-server shell
```

### Backup & Recovery
```bash
# Backup databases
docker compose exec postgres-netbox pg_dump -U netbox netbox > netbox_backup.sql
docker compose exec postgres-nautobot pg_dump -U nautobot nautobot > nautobot_backup.sql

# Backup volumes
docker run --rm -v netmgmt-suite_pgdata-netbox:/data -v $(pwd):/backup alpine tar czf /backup/netbox_data.tar.gz -C /data .
```

## 🔐 Security

### Default Security Features
- **Strong Passwords**: All services use strong default passwords
- **Secret Key Generation**: Django secret keys are auto-generated
- **Resource Limits**: CPU and memory limits prevent resource exhaustion
- **Health Checks**: Comprehensive health monitoring
- **Network Isolation**: Services run in isolated Docker network

### Security Hardening
1. **Change Default Passwords**: Update all passwords in .env
2. **Use Secrets Management**: Consider using Docker secrets for production
3. **Enable HTTPS**: Configure reverse proxy with SSL certificates
4. **Network Security**: Restrict access via firewall rules
5. **Regular Updates**: Keep Docker images updated

## 🚨 Troubleshooting

### Common Issues

#### Services Won't Start
```bash
# Check service status
make ps

# View detailed logs
make logs

# Check resource usage
docker stats
```

#### Database Connection Issues
```bash
# Check database health
docker compose exec postgres-netbox pg_isready -U netbox
docker compose exec postgres-nautobot pg_isready -U nautobot

# Reset databases (DESTRUCTIVE!)
make destroy
make up
make bootstrap
```

#### Observability Integration Issues
```bash
# Test connectivity to observability stack
curl http://192.168.5.13:9200/_cluster/health
curl http://192.168.5.13:9090/api/v1/status/config

# Check Filebeat logs
docker compose logs filebeat
```

#### Performance Issues
```bash
# Monitor resource usage
docker stats

# Check service health
docker compose ps

# Adjust resource limits in docker-compose.yml
```

### Log Locations
- **Application Logs**: Shipped to ELK stack via Filebeat
- **Docker Logs**: `docker compose logs <service>`
- **Filebeat Logs**: `/var/log/filebeat/` in container

## 📚 Additional Resources

### Documentation
- [NetBox Documentation](https://docs.netbox.dev/)
- [Nautobot Documentation](https://docs.nautobot.com/)
- [Jenkins Documentation](https://www.jenkins.io/doc/)
- [Oxidized Documentation](https://github.com/ytti/oxidized)

### Plugins & Extensions
- **NetBox Plugins**: Topology views, BGP, Onboarding
- **Nautobot Apps**: Nornir, SSOT, Device Onboarding, BGP Models

### Support
- Check service health: `make ps`
- View logs: `make logs`
- Restart services: `make down && make up`

## 🎯 Next Steps

1. **Initial Setup**: Complete the quick start guide
2. **Configure Services**: Set up NetBox/Nautobot with your network data
3. **Create Pipelines**: Build Jenkins jobs for network automation
4. **Setup Monitoring**: Import Prometheus config to your observability stack
5. **Create Dashboards**: Build Grafana dashboards for network metrics
6. **Setup Alerts**: Configure Alertmanager rules for critical events

---

**Note**: This suite is designed for network management and automation. Ensure you have proper backups and test in a non-production environment first.
